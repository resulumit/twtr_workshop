---
title: 'Data Analysis: Tweets'
output: html_document
---

```{r, setup, include=FALSE}

# setup for this document
knitr::opts_chunk$set(echo = FALSE, cache = TRUE)

# install packages that does not need to be loaded
# install.packages("rmakdown")   # running this document   
# install.packages("textdata")   # sentiment dictionary

# load packages
library(rtweet)        # collecting tweets
library(tidytext)      # working with texts, sentiment analysis
library(doc2concrete)  # concreteness scores
library(dotwhisker)    # visualising regression results
library(tidygraph)     # network analysis
library(ggraph)        # network analysis
library(tidyverse)     # most other operations

# load data
mps <- read.csv("../data/mps.csv", na.strings = "")
twts <- read_rds("../data/tweets.rds")

```

## How to use this document

This R Markdown document includes the exercises for Part 6 of the workshop, [Working with Twitter Data in R](https://resulumit.com/teaching/twtr_workshop.html#1). It introduces each exercise with a subtitle, followed by some explanations and a code chunk. Type your code into these chunks to complete the exercises.

If these exercises are too easy for you, I recommend analysing your own dataset or conducting additional analyses on the same dataset in parallel. If they are on the other hand too hard, the comments in the chunks might help you. If they are still too inaccessible to you, you may wish to follow on with the `tweets_answers.Rmd` instead, which include the code.

If you have the `rmarkdown` package installed, you can see the results in two ways:

1) by clicking on the *Knit* button on the RStudio menu
    - this runs the codes in all chunks   
    - the results will appear in a separate HTML document that will pop up
    
2) by clicking on the green arrow on the top-right corner of any chunk
    - this runs the code in that chunk only    
    - the result will appear immediately under the relevant chunk


### when did they tweet?

The dataset covers the second half of January 2021, from the 15^th^ to the 31^st^ of the month. However, it is likely that MPs were not equally active on Twitter on very day in this period. Visualise the number tweets sent on each date to find out. 

```{r, exercise_62, echo=FALSE}

# start with the `tweets` dataset 
twts %>%

# turn the the created_at variable into a date variable, with the as.Date function 
  mutate(date = as.Date(created_at)) %>%

# calculate how many tweets posted on each date
  count(date) %>%
  
# graph the result
  ggplot(aes(x = date, y = n)) +
  geom_line() +
  theme_bw() +
  scale_x_date(date_breaks = "2 day", date_labels = "%b %d") +
  ylab("Number of Tweets\n") + xlab("\nDate")

```
### What day of the week do they tweet?

The previous graph shows regular dips. Do those dips occur on  specific days of the week, such as on the weekend? Visualise the average number tweets sent on each day of the week to find out. 

```{r, exercise_63, echo=FALSE}

twts %>%
  filter(is_retweet == FALSE) %>%
  mutate(day = format(created_at, tz = "GB", "%A"),
         day = factor(day, levels = c("Monday", "Tuesday", "Wednesday", "Thursday",
                                      "Friday", "Saturday", "Sunday")),
         week = format(created_at, tz = "GB", "%W")) %>%
  group_by(week, day) %>% 
  summarise(by_day = n()) %>%
  group_by(day) %>% 
  summarise(mean_tweets = mean(by_day)) %>%
  ggplot(aes(day, mean_tweets)) +
  geom_line(aes(group = 1), size = 1) +
  theme_bw() +
  ylab("Number of Tweets\n") + xlab("\nDays") +
  scale_x_discrete(breaks = c("Monday", "Tuesday", "Wednesday", "Thursday",
                              "Friday", "Saturday", "Sunday"))

```

### What time of the day do they tweet?

Similarly, we could explore the time of the day that MPs tweet. Visualise the average number tweets sent on each hour of the day to explore. 

```{r, exercise_64, echo=FALSE}

twts %>%
  mutate(hour = format(created_at, tz = "GB", "%H")) %>%
  group_by(hour) %>%
  summarise(n_tweets = n()) %>%
  ggplot(aes(hour, n_tweets)) +
  geom_line(aes(group = 1), size = 1) +
  theme_bw() +
  ylab("Number of Tweets\n") + xlab("\nHours")

```


### What hastags do they use the most often?

Hastags categorise the content on Twitter. As such, they can be informative about what the tweets are about. What do MPs tweet about? To explore, visualise the top 20 most used hashtags in the dataset.

Recall that the hashtag variable includes lists of hastags if a tweet itself has more than one hashtag. This requires tokenising them first. 

```{r, exercise_65, echo=FALSE}

twts %>%

  filter(is_retweet == FALSE & !is.na(hashtags)) %>%

# unlist the lists of hashtags to create strings
  group_by(status_id) %>%
  mutate(tidy_hashtags = str_c(unlist(hashtags), collapse = " ")) %>%

  ungroup() %>%
  
# split the string, create a new variable called `da_tweets`
  unnest_tokens(output = unnested_hashtags, input = tidy_hashtags, token = "words") %>%

  count(unnested_hashtags) %>%
  top_n(20) %>%
  ggplot(aes(y = reorder(unnested_hashtags, n),
             x = n)) +
  geom_bar(stat = "identity") +
  theme_bw() +
  ylab("Top 20 Hashtags\n") + xlab("")

```











### Something else interesting

Conduct another user-based analysis of Twitter data --- something that interests you. Work in groups of two, on the same datasets of one that you might have. Present your results to the class.


```{r, exercise_61, echo=FALSE}



```
